rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Users:
    // - User can create their own document on signup.
    // - User can only read or update their own document.
    // - User cannot delete their own document directly.
    match /users/{userId} {
      allow read, update: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null;
      allow delete: if false;
    }

    // Usernames:
    // - Username documents are created during signup transaction by an authenticated user.
    // - Allow public read for client-side username existence check.
    //   Note: This makes username existence queryable by anyone. A more secure approach
    //   for checking username uniqueness without exposing all usernames would involve a Cloud Function.
    // - Usernames are generally immutable and not directly updatable/deletable by clients.
    match /usernames/{username} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if false;
    }
  }
}
