name: CI Checks
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  env_check:
    name: Check for .env files
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check if .env files are committed
        run: |
          # Check if any file starting with .env exists
          if ls .env* 1> /dev/null 2>&1; then
            echo "Error: A .env file was found in the repository!"
            echo "Please remove it and ensure '.env*' is in your .gitignore file."
            exit 1
          else
            echo ".env files are correctly ignored and not present."
            exit 0
          fi
  lint:
    name: ESLint
    runs-on: ubuntu-latest
    needs: env_check
    steps:
      - uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
          cache: 'yarn'      
      
      - name: Install dependencies
        run: yarn install --frozen-lockfile
      
      - name: Run linter
        run: yarn lint

  typecheck:
    name: TypeScript Check
    runs-on: ubuntu-latest
    needs: env_check
    steps:
      - uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'yarn'
      
      - name: Install dependencies
        run: yarn install --frozen-lockfile
      
      - name: Run type check
        run: yarn typecheck

  build:
    name: Build Check
    runs-on: ubuntu-latest
    needs: [lint, typecheck] 
    steps:
      - uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'yarn'
      
      - name: Install dependencies
        run: yarn install --frozen-lockfile
      
      - name: Run build
        run: yarn build

  tests:
    name: Unit Tests
    runs-on: ubuntu-latest
    needs: build 
    steps:
      - uses: actions/checkout@v4
      - name: Run tests
        run: |
          echo "Warning: No 'test' script found in package.json."
          echo "To run tests, please add a 'test' script to your package.json."
          # We exit 0 so this check passes but still provides a warning
          exit 0
